/*! dvorak.ninja 2015-04-10 */
!function(a){"use strict";window.WPM=window.WPM||{},window.WPM.gameModes={IDLE:"idle",PREGAME:"pregame",PLAYING:"playing",POSTGAME:"postgame"},window.WPM.Game=function(){function b(){var a=void 0!==k&&k.length>0;return a&&void 0===f?o.PREGAME:a&&void 0!==f?o.PLAYING:a||void 0===f?o.IDLE:o.POSTGAME}function c(){clearInterval(d),d=void 0;var h=e;if(e=b(),h===o.PLAYING||e===o.PLAYING){var p=(a.now()-f)/1e3,q=i.length,r=i.length/5,s=r/(p/60),t=q/l*100;a(n).trigger({type:"scorechange.wpm",mode:e,seconds:p,characters:q,words:r,wpm:s,accuracy:t,wordSetName:g,times:m})}e!==h&&a(n).trigger({type:"modechange.wpm",mode:e,oldMode:h}),(e===o.PREGAME||h===o.PREGAME)&&a(n).trigger({type:"textchange.wpm",mode:e,correctlyTyped:i,incorrectlyTyped:j,notYetTyped:k,nextLetter:k[0],change:0}),e===o.PLAYING&&(d=setTimeout(c,100))}var d,e,f,g,h,i,j,k,l,m,n=this,o=window.WPM.gameModes;this.init=function(){void 0===e&&c()},this.changeWordList=function(a,b){f=void 0,g=a,h=k=b,i=j="",l=0,m=[],c()},this.start=function(){e===o.PREGAME&&(f=a.now(),c())},this.letterTyped=function(b){if(e===o.PREGAME)return void this.start();if(e===o.PLAYING){l++;var d=0,g=k.substr(0,1);if(0===j.length&&b===g){i+=b,k=k.substr(1),d=1;var h=m.length>0?m[m.length-1].time:f,p=a.now();m.push({letter:b,time:p,duration:p-h})}else{if(!(j.length<=10))return;j+=b}a(n).trigger({type:"textchange.wpm",correctlyTyped:i,incorrectlyTyped:j,notYetTyped:k,nextLetter:j?!1:k[0],change:d}),c()}},this.backspaceTyped=function(){if(e===o.PLAYING){var b=0;if(j.length>0)j=j.substr(0,j.length-1);else{if(!(i.length>0))return;k=i[i.length-1]+k,i=i.substr(0,i.length-1),b=-1,m.pop()}a(n).trigger({type:"textchange.wpm",correctlyTyped:i,incorrectlyTyped:j,notYetTyped:k,nextLetter:j?!1:k[0],change:b}),c()}}}}(jQuery),function(a){"use strict";window.WPM=window.WPM||{},window.WPM.Input=function(b,c){var d=this;b.on("keydown",function(b){return b.altKey||b.ctrlKey||b.metaKey?!0:8===b.keyCode?(a(d).trigger({type:"backspacepress.wpm"}),!1):void 0}),b.on("keypress",function(b){var e=c.fromCharCode(b.charCode);return e?(a(d).trigger({type:"letterpress.wpm",letter:e}),!1):void 0})}}(jQuery),function(){"use strict";window.WPM=window.WPM||{},window.WPM.KeyboardMapper=function(){var a={"null":{},qwertyToDvorak:{a:"a",A:"A",b:"x",B:"X",c:"j",C:"J",d:"e",D:"E",e:".",E:">",f:"u",F:"U",g:"i",G:"I",h:"d",H:"D",i:"c",I:"C",j:"h",J:"H",k:"t",K:"T",l:"n",L:"N",m:"m",M:"M",n:"b",N:"B",o:"r",O:"R",p:"l",P:"L",q:"'",Q:'"',r:"p",R:"P",s:"o",S:"O",t:"y",T:"Y",u:"g",U:"G",v:"k",V:"K",w:",",W:"<",x:"q",X:"Q",y:"f",Y:"F",z:";",Z:";","-":"[",_:"{","=":"]","+":"}","[":"/","{":"?","]":"=","}":"+",";":"s",":":"S","'":"-",'"':"_",",":"w","<":"W",".":"v",">":"V","/":"z","?":"Z"}},b=null;this.fromCharCode=function(c){var d=String.fromCharCode(c);return a[b][d]||d},this.changeMap=function(c){b=void 0!==a[c]?c:null}}}(),function(a){"use strict";window.WPM=window.WPM||{},window.WPM.LayoutBox=function(b,c,d){function e(b,c){for(var d=0;d<c.length;d++){for(var e=a('<div class="row-'+d+'">'),f=0;f<c[d].length;f++){var g=a('<span class="key">').text(c[d][f][0]).toggleClass("home",1===d&&(f>=0&&3>=f||f>=6&&9>=f)).toggleClass("bump",1===d&&(3===f||6===f)).appendTo(e);for(var h in c[d][f])g.addClass("key-"+c[d][f][h].charCodeAt())}e.appendTo(b)}}var f=this,g=window.WPM.gameModes,h={qwerty:[["Qq","Ww","Ee","Rr","Tt","Yy","Uu","Ii","Oo","Pp","[{","]}"],["Aa","Ss","Dd","Ff","Gg","Hh","Jj","Kk","Ll",";:","'\""],["Zz","Xx","Cc","Vv","Bb","Nn","Mm",",<",".>","/?"]],dvorak:[["'\"",",<",".>","Pp","Yy","Ff","Gg","Cc","Rr","Ll","/?","=+"],["Aa","Oo","Ee","Uu","Ii","Dd","Hh","Tt","Nn","Ss","-_"],[";:","Qq","Jj","Kk","Xx","Bb","Mm","Ww","Vv","Zz"]]};this.modeChanged=function(){b.find(".key.next").removeClass("next"),c.find(".key.next").removeClass("next")},this.textChanged=function(a){a.mode===g.PLAYING&&(b.find(".key.next").removeClass("next"),c.find(".key.next").removeClass("next"),a.nextLetter&&(b.find(".key.key-"+a.nextLetter.charCodeAt()).addClass("next"),c.find(".key.key-"+a.nextLetter.charCodeAt()).addClass("next")))},d.on("change",function(){var b=a(this).is(":checked")?"qwertyToDvorak":null;return a(f).trigger({type:"layoutchange.wpm",mapName:b}),a(this).blur(),!1}),e(b,h.qwerty),e(c,h.dvorak)}}(jQuery),function(){"use strict";window.WPM=window.WPM||{},window.WPM.ScoreBox=function(a){function b(a){var b={},c=12;for(var d in a){for(var e=0,f=0,g=0,h=d;h>=0&&(g+=a[h].duration,1e3>=g&&e++,5e3>=g);h--)f++;g>=1e3&&(b.min=Math.min(b.min||1/0,e*c),b.max=Math.max(b.max||0,e*c)),g>=5e3&&(b.min5=Math.min(b.min5||1/0,f*c/5),b.max5=Math.max(b.max5||0,f*c/5))}return b}function c(a){var b,c={};for(var d in a)b=a[d].letter,void 0===c[b]&&(c[b]={letter:b,count:0,duration:0,average:0}),c[b].count++,c[b].duration+=a[d].duration,c[b].average=c[b].duration/c[b].count;var e=[];for(b in c)e.push(b);return e.sort(function(a,b){return c[b].average-c[a].average}),e}var d=window.WPM.gameModes;this.modeChanged=function(b){b.mode!==d.POSTGAME&&(a.css("visibility","hidden"),a.find(".min .value1").text("--"),a.find(".min .value5").text("--"),a.find(".max .value1").text("--"),a.find(".max .value5").text("--"),a.find(".missed .value").text("- - - - -"))},this.scoreChanged=function(e){if(e.mode===d.POSTGAME){var f=c(e.times),g=b(e.times);a.find(".min .value1").text(void 0!==g.min?~~g.min:"??"),a.find(".min .value5").text(void 0!==g.min5?~~g.min5:"??"),a.find(".max .value1").text(void 0!==g.max?~~g.max:"??"),a.find(".max .value5").text(void 0!==g.max5?~~g.max5:"??"),a.find(".missed .value").text(f.splice(0,5).join(" ")),a.css("visibility","visible")}}}}(),function(a,b){"use strict";window.WPM=window.WPM||{},window.WPM.SocialBox=function(c){function d(a){for(var b=5381,c=0;c<a.length;c++)b=(b<<5)+b+a.charCodeAt(c);return b}function e(a){return"Guest"+d(a).toString(10).substr(-5)}var f,g=window.WPM.gameModes,h=new b(window.WPM.firebaseURL);h.authAnonymously(function(a,b){if(b){f=b;var c=h.child("presence").child(f.uid);c.onDisconnect().remove(),c.set(!0)}}),h.child("presence").on("value",function(a){var b=Object.keys(a.val()).length;c.find(".user-count .value").text(b)}),h.child("score").orderByChild("timestamp").limitToLast(5).on("child_added",function(b){var d=c.find("table"),e=d.find("tbody");0===e.length&&(e=a("<tbody>").appendTo(d));var f,g=b.val(),h=~~(g.score.seconds/60),i=~~(g.score.seconds-60*h);f=h+":"+("0"+i).substr(-2);var j=new Date(g.timestamp),k=a("<tr>");a("<td>").text(g.user.name).appendTo(k),a("<td>").text(~~g.score.wpm).appendTo(k),a("<td>").text(~~g.score.accuracy+"%").appendTo(k),a("<td>").text(~~g.score.characters).appendTo(k),a("<td>").text(f).appendTo(k),a("<td>").text(g.wordSet.name).appendTo(k),a("<td>").text(j.toLocaleString()).appendTo(k),k.prependTo(e),e.children().slice(5).remove()}),this.scoreChanged=function(a){a.mode===g.POSTGAME&&h.child("score").push({user:{name:e(f.uid)},timestamp:a.timeStamp,wordSet:{name:a.wordSetName},score:{seconds:a.seconds,characters:a.characters,wpm:a.wpm,accuracy:a.accuracy}})}}}($,Firebase),function(){"use strict";window.WPM=window.WPM||{},window.WPM.StatsBox=function(a){var b=window.WPM.gameModes;this.modeChanged=function(c){(c.mode===b.PREGAME||c.mode===b.IDLE)&&(a.find(".wpm .value").text("---"),a.find(".accuracy .value").text("---%"),a.find(".characters .value").text("---"),a.find(".time .value").text("-:--"))},this.scoreChanged=function(b){var c;if(void 0!==b.seconds){var d=~~(b.seconds/60),e=~~(b.seconds-60*d);c=d+":"+("0"+e).substr(-2)}a.find(".wpm .value").text(~~b.wpm),a.find(".accuracy .value").text(~~b.accuracy+"%"),a.find(".characters .value").text(~~b.characters),a.find(".time .value").text(c)}}}(),function(){"use strict";window.WPM=window.WPM||{},window.WPM.TypeBox=function(a,b){function c(a){return String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\s/g,"&nbsp;")}var d=window.WPM.gameModes;this.modeChanged=function(c){c.mode===d.IDLE?(b.html("&mdash; Select a word set from above &mdash;").show(),a.html("")):c.mode===d.PREGAME?(b.html("&mdash; Press any key to begin &mdash;").show(),a.html('<span class="remaining"></span>')):c.mode===d.PLAYING&&(b.html("").hide(),a.html('<span class="correct"></span><span class="incorrect"></span><span class="cursor"></span><span class="remaining"></span>')),a.toggleClass("completed",c.mode===d.POSTGAME)},this.textChanged=function(b){var d,e="";for(d=0;d<b.correctlyTyped.length;d++)e+=c(b.correctlyTyped[d])," "===b.correctlyTyped[d]&&(e+="<wbr>");var f="";for(d=0;d<b.incorrectlyTyped.length;d++)f+=c(b.incorrectlyTyped[d]),(d>=b.notYetTyped.length||" "===b.notYetTyped[d])&&(f+="<wbr>");var g="";for(d=b.incorrectlyTyped.length;d<b.notYetTyped.length;d++)g+=c(b.notYetTyped[d])," "===b.notYetTyped[d]&&(g+="<wbr>");a.find(".correct").html(e),a.find(".incorrect").html(f),a.find(".remaining").html(g)},this.scoreChanged=function(b){if(b.mode===d.POSTGAME){var e=1/0,f=500;for(var g in b.times)e=Math.min(e,b.times[g].duration),f=Math.max(f,b.times[g].duration);a.html('<span class="results"></span>');var h=a.find(".results");for(g in b.times){var i=(b.times[g].duration-e)/(f-e),j=c(b.times[g].letter);" "===b.times[g].letter&&(j+="<wbr>"),$('<span class="letter">').html(j).css("background-color","rgba(217, 83, 79, "+i+")").appendTo(h)}}}}}(),function(a){"use strict";window.WPM=window.WPM||{},window.WPM.WordSetBox=function(b,c){function d(a){for(var b,c,d=a.length;--d;)c=~~(Math.random()*(d+1)),b=a[d],a[d]=a[c],a[c]=b;return a}var e=this;for(var f in b){var g=a("<li>");a('<a class="word-set" href="#">').text(b[f].name).data("word-set",b[f].text).data("shuffle",b[f].shuffle===!0).data("limit",b[f].limit).appendTo(g),g.appendTo(c)}c.find("a.word-set").on("click",function(){var b=a(this).data("word-set");a(this).data("shuffle")===!0&&(b=d(b.split(" ")).join(" "));var f=a(this).data("limit");return f>0&&(b=b.split(" ").slice(0,f).join(" ")),a(e).trigger({type:"wordlistchange.wpm",name:a(this).text(),wordList:b}),c.find("li a.active").removeClass("active"),a(this).addClass("active").blur(),!1})}}(jQuery),function(){"use strict";window.WPM=window.WPM||{},window.WPM.firebaseURL="http://wpm.firebaseio.com/",window.WPM.wordSets=[{name:"Dvorak 1 [aeouhtns]",text:"eats unset seats noses onto asset sane note oath nests shut hates shush tans sate hues tune oats shoot shoe auto shot autos totes antes tenet huts nest ethos host shoos tonne tan sooth stone net nose stuns test east shout too shuts souse sheet one tenon son hose snots ton sent toes tees out senna nun tutus tease tunes sees tots that tho the state eases shoo aeon noon noose hath taste nosh hat hens tost hoes eons tutu teen neon hue ten anon nth tones neat tush anons sues ones set heats none teeth sea stun aunt stout",shuffle:!0,limit:50},{name:"Dvorak 2 [id]",text:"dissents thinness assassination annotates statehouse disuse tidiest shoeshines headset anoint ashiest atone undies seasoned settees nosiness untested sedatest intensest shone shoots insets detention sinus distention sustain sententious tided anaesthesia heaths tenses assassinate stains editions eased stash shunned nudes stoniest enthusiast dunned dietitian toniest neatness season suntan easiest heisted annotate untainted denuded oaths donuts shoddiness shooed hunts sassed densities headstone audited insinuation dudes hostess dietitians seasides siesta undated sonnet sainthood enthusiasts audits noses doted institution hoods assisted sheen hotheadedness inset shush dosed tattooists dandiest antidotes outdone insistent atones notations ensued tannin haunted dustiest tides stationed dense eddied outed deadest shodden sundaes",shuffle:!0,limit:50},{name:"Dvorak 3 [cfklmprv]",text:"partitions inked visit months scammed hoorahs epics internship fondu milks carousals honorific ducts stilled concretes avatars speller enslave moderns pictured preponderate freeholders smirks missions litter tradesmen printer turned radius antihistamine forth patches transcendentalist interlink ruffs admiration satisfaction financial pauses ecstasies moochers sheller pioneered maidenheads accommodate refresh counterpoints platformed riddle aortas purloin occult merchantmen complainers patchier penlites clasps recoup continue rookie stuffed dipsomania footloose muralists unloved trickiest savvied minefields mainland coifed attempt uniform seventeens roasted technicians corsair stalemate terraria impulses scuds preparation tinier cattail limpet overeaten niter trammelled investiture administrators interstates carpets officious aseptic illusive mentored upend repeater commandoes middle reverenced",shuffle:!0,limit:50},{name:"Dvorak 4 [bgjqwxyz]",text:"banqueting squishes bisque antiquated bonging zoned batting hobbyist jawed awash swath showbiz soybean aqueous whitings subduing outsizes oxygenated headwinds downy seabeds bandits thawed anaesthetizing adjoin absenting wends signings highs joists dinginess doggonedest budge anaesthetize downsizes inundating indebted waysides busyness gauziest ghosting antique dogged satiny twinning swathing signets subjugating hogshead aweigh antiquates instigates bogeys seized gabbing ghettoes dousing bingeing beads adequate sandhogs dizziest agitations dozing gowned toxins swagged botany sexist bagging aquas debase baths shebangs adobes budged hubbies nightgown gunshot budgets headbands hogging guest beatings snobbishness nabbing snowy equation sowing washtub twinned washout yeast dotage hiding banjoist quanta beaded owning dyeing",shuffle:!0,limit:50},{name:"Dvorak 5 [a-z]",text:"charmed limns headgear sanserif coinciding bottling commentaries normal intervene hippest restatements draftier grubbiest empire crystallizes kinglier embracing hybrid spins washtubs upkeep sweetheart chateaus ethics brands parting hospitalize heaping perspired retorting alternated prettified islets moneybag straightens boogieing steed directional annoyingly typewrite routinize interact comparatively glorious forego contingency neurotically simplicity geegaws implausibly corpora journalists conscientious disgustingly appeases proportionate feasible dropping counteracts terrorize northerners vehemently opined meets portioning ammonia aesthetes usage legatees suspicious chaster equipment hangings sandbagging laundresses mortality underacted districts incoherence nibbles refrigerating wallet footing backings register grits fleeced amongst spake sponger shareholder dorkier superman excited pommel rhinoceroses whaler piddling hydrae prerecords",shuffle:!0,limit:50},{name:"Quote 1",text:"Let me tell you why you're here.  You're here because you know something.  What you know you can't explain, but you feel it.  You've felt it your entire life, that there's something wrong with the world.  You don't know what it is, but it's there, like a splinter in your mind, driving you mad.  It is this feeling that has brought you to me.  Do you know what I'm talking about?"},{name:"Quote 2",text:"The path of the righteous man is beset on all sides by the iniquities of the selfish and the tyranny of evil men.  Blessed is he who, in the name of charity and good will, shepherds the weak through the valley of darkness, for he is truly his brother's keeper and the finder of lost children.  And I will strike down upon thee with great vengeance and furious anger those who attempt to poison and destroy my brothers.  And you will know my name is the Lord when I lay my vengeance upon thee."}]}(),function(a){"use strict";var b=new WPM.Game,c=new WPM.KeyboardMapper,d=new WPM.Input(a(document),c);a(d).on("letterpress.wpm",function(a){b.letterTyped(a.letter)}),a(d).on("backspacepress.wpm",function(){b.backspaceTyped()});var e=new WPM.WordSetBox(WPM.wordSets,a("#word-set-box"));a(e).on("wordlistchange.wpm",function(a){b.changeWordList(a.name,a.wordList)});var f=new WPM.TypeBox(a("#type-box"),a("#overlay-box"));a(b).on("modechange.wpm",f.modeChanged),a(b).on("textchange.wpm",f.textChanged),a(b).on("scorechange.wpm",f.scoreChanged);var g=new WPM.StatsBox(a("#stats-box"));a(b).on("modechange.wpm",g.modeChanged),a(b).on("scorechange.wpm",g.scoreChanged);var h=new WPM.LayoutBox(a("#qwerty-layout"),a("#dvorak-layout"),a("#map-qwerty-to-dvorak"));a(b).on("modechange.wpm",h.modeChanged),a(b).on("textchange.wpm",h.textChanged),a(h).on("layoutchange.wpm",function(a){c.changeMap(a.mapName)});var i=new WPM.ScoreBox(a("#score-box"));a(b).on("modechange.wpm",i.modeChanged),a(b).on("scorechange.wpm",i.scoreChanged);var j=new WPM.SocialBox(a("#social-box"));a(b).on("scorechange.wpm",j.scoreChanged),b.init(),a("#widget").show()}(jQuery);